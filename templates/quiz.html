<!doctype html>
<html lang="fr"><head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/static/style.css">
  <title>Quiz ‚Äì PodoTest</title>
</head>
<body class="page">
  <div class="quiz-wrap">

    <!-- √âtape 2/2 -->
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:20px" class="animate-in">
      <div class="step-dot done">‚úì</div>
      <div class="step-line done"></div>
      <div class="step-dot active">2</div>
      <span style="font-size:.82rem;color:var(--text2);margin-left:6px">√âtape 2 / 2 ‚Äî Quiz</span>
    </div>

    <div class="card animate-in" style="animation-delay:.05s">

      <!-- Header -->
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:8px">
        <div>
          <div class="eyebrow">ü¶∂ PodoTest</div>
          <h1 style="font-size:1.6rem;margin:4px 0 0">Bonjour {{ prenom }} !</h1>
        </div>
        <div style="text-align:right">
          <div id="counter" style="font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;color:var(--teal)">1 / {{ questions|length }}</div>
          <div style="font-size:.75rem;color:var(--text2)">question</div>
        </div>
      </div>

      <!-- Barre de progression -->
      <div class="progress-track">
        <div class="progress-fill" id="progress" style="width:0%"></div>
      </div>

      <!-- Formulaire -->
      <form id="quizForm" method="post" action="/t/{{ token }}">
        {% for q in questions %}
        <div class="question-card{% if loop.first %} active{% endif %}" id="qcard-{{ loop.index0 }}">

          <div class="q-meta">
            <span class="q-num">Question {{ loop.index }} / {{ questions|length }}</span>
            {% set topic_colors = ['tag-teal','tag-blue','tag-coral','tag-gold','tag-teal'] %}
            <span class="tag {{ topic_colors[loop.index0 % 5] }}">{{ q.topic }}</span>
          </div>

          <div class="q-text">{{ q.text }}</div>

          {% if q.kind == "multi" %}
          <div class="hint-multi">üí° Plusieurs r√©ponses possibles</div>
          {% endif %}

          {% if q.kind == "single" %}
            {% for c in q.choices %}
            <label class="choice-label" id="lbl-{{ q.id }}-{{ c.id }}">
              <input type="radio" name="q{{ q.id }}" value="{{ c.id }}" onchange="highlightChoice(this)">
              <span>{{ c.label }}</span>
            </label>
            {% endfor %}
          {% else %}
            {% for c in q.choices %}
            <label class="choice-label" id="lbl-{{ q.id }}-{{ c.id }}">
              <input type="checkbox" name="q{{ q.id }}" value="{{ c.id }}" onchange="highlightChoice(this)">
              <span>{{ c.label }}</span>
            </label>
            {% endfor %}
          {% endif %}

        </div>
        {% endfor %}

        <!-- Carte de confirmation finale -->
        <div class="question-card" id="qcard-final">
          <div class="final-card">
            <div class="final-icon">‚úÖ</div>
            <h2 style="margin-bottom:10px">Tout est compl√©t√© !</h2>
            <p class="muted" style="margin-bottom:24px">
              Vous avez r√©pondu √† toutes les questions.<br>
              Cliquez sur <strong>Envoyer</strong> pour valider.
            </p>
            <button type="submit" class="btn btn-primary"
                    style="padding:15px 36px;font-size:1.05rem">
              üöÄ Envoyer mes r√©ponses
            </button>
          </div>
        </div>

      </form>

      <div class="msg-feedback" id="msg"></div>

      <!-- Boutons navigation -->
      <div class="nav-btns" id="navBtns">
        <button class="btn btn-secondary" id="btnPrev" onclick="navigate(-1)" type="button">
          ‚Üê Pr√©c√©dent
        </button>
        <button class="btn btn-primary" id="btnNext" onclick="navigate(1)" type="button">
          Suivant ‚Üí
        </button>
      </div>

    </div>
  </div>

  <script>
    const TOTAL = {{ questions|length }};
    let current = 0;

    function showCard(idx) {
      document.querySelectorAll('.question-card').forEach(c => c.classList.remove('active'));
      const id = idx < TOTAL ? 'qcard-' + idx : 'qcard-final';
      document.getElementById(id).classList.add('active');

      // Progression
      const pct = Math.round((idx / TOTAL) * 100);
      document.getElementById('progress').style.width = pct + '%';

      // Compteur
      document.getElementById('counter').textContent =
        idx < TOTAL ? (idx + 1) + ' / ' + TOTAL : '‚úì';

      // Boutons
      const navBtns = document.getElementById('navBtns');
      document.getElementById('btnPrev').disabled = (idx === 0);
      if (idx >= TOTAL) {
        navBtns.style.display = 'none';
      } else {
        navBtns.style.display = 'flex';
        document.getElementById('btnNext').textContent =
          idx === TOTAL - 1 ? 'Terminer ‚úì' : 'Suivant ‚Üí';
      }
      document.getElementById('msg').textContent = '';
    }

    function navigate(dir) {
      const next = current + dir;
      if (next < 0 || next > TOTAL) return;
      current = next;
      showCard(current);
      window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function highlightChoice(input) {
      const card = input.closest('.question-card');
      if (input.type === 'radio') {
        card.querySelectorAll('.choice-label').forEach(l => l.classList.remove('selected'));
        input.closest('.choice-label').classList.add('selected');
      } else {
        if (input.checked) input.closest('.choice-label').classList.add('selected');
        else input.closest('.choice-label').classList.remove('selected');
      }
    }

    showCard(0);
  </script>
</body></html>
